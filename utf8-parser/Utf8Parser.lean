-- THIS FILE WAS AUTOMATICALLY GENERATED BY AENEAS
-- [utf8_parser]
import Aeneas
open Aeneas.Std Result Error
set_option linter.dupNamespace false
set_option linter.hashCommand false
set_option linter.unusedVariables false

namespace utf8_parser

/- [utf8_parser::utf8::sequence_length]:
   Source: 'src/utf8.rs', lines 14:0-26:1 -/
def utf8.sequence_length (first_byte : U8) : Result U8 := do
  let i ← (↑(first_byte &&& 128#u8) : Result U8)
  if i = 0#u8
  then ok 1#u8
  else
    let i1 ← (↑(first_byte &&& 224#u8) : Result U8)
    if i1 = 192#u8
    then ok 2#u8
    else
      let i2 ← (↑(first_byte &&& 240#u8) : Result U8)
      if i2 = 224#u8
      then ok 3#u8
      else
        let i3 ← (↑(first_byte &&& 248#u8) : Result U8)
        if i3 = 240#u8
        then ok 4#u8
        else ok 0#u8

/- [utf8_parser::utf8::is_continuation]:
   Source: 'src/utf8.rs', lines 29:0-31:1 -/
def utf8.is_continuation (byte : U8) : Result Bool := do
  let i ← (↑(byte &&& 192#u8) : Result U8)
  ok (i = 128#u8)

/- [utf8_parser::utf8::is_leading]:
   Source: 'src/utf8.rs', lines 34:0-36:1 -/
def utf8.is_leading (byte : U8) : Result Bool := do
  let i ← utf8.sequence_length byte
  ok (i > 0#u8)

/- [utf8_parser::utf8::validate_1byte]:
   Source: 'src/utf8.rs', lines 39:0-41:1 -/
def utf8.validate_1byte (b0 : U8) : Result Bool := do
  let i ← utf8.sequence_length b0
  ok (i = 1#u8)

/- [utf8_parser::utf8::validate_2byte]:
   Source: 'src/utf8.rs', lines 44:0-46:1 -/
def utf8.validate_2byte (b0 : U8) (b1 : U8) : Result Bool := do
  let i ← utf8.sequence_length b0
  if i = 2#u8
  then utf8.is_continuation b1
  else ok false

/- [utf8_parser::utf8::validate_3byte]:
   Source: 'src/utf8.rs', lines 49:0-51:1 -/
def utf8.validate_3byte (b0 : U8) (b1 : U8) (b2 : U8) : Result Bool := do
  let i ← utf8.sequence_length b0
  if i = 3#u8
  then
    let b ← utf8.is_continuation b1
    if b
    then utf8.is_continuation b2
    else ok false
  else ok false

/- [utf8_parser::utf8::validate_4byte]:
   Source: 'src/utf8.rs', lines 54:0-59:1 -/
def utf8.validate_4byte
  (b0 : U8) (b1 : U8) (b2 : U8) (b3 : U8) : Result Bool := do
  let i ← utf8.sequence_length b0
  if i = 4#u8
  then
    let b ← utf8.is_continuation b1
    if b
    then
      let b4 ← utf8.is_continuation b2
      if b4
      then utf8.is_continuation b3
      else ok false
    else ok false
  else ok false

/- [utf8_parser::utf8::CodePoint]
   Source: 'src/utf8.rs', lines 65:0-68:1 -/
structure utf8.CodePoint where
  bytes : Array U8 4#usize
  len : U8

/- [utf8_parser::utf8::code_point_1]:
   Source: 'src/utf8.rs', lines 71:0-76:1 -/
def utf8.code_point_1 (b0 : U8) : Result utf8.CodePoint := do
  ok { bytes := (Array.make 4#usize [ b0, 0#u8, 0#u8, 0#u8 ]), len := 1#u8 }

/- [utf8_parser::utf8::code_point_2]:
   Source: 'src/utf8.rs', lines 79:0-84:1 -/
def utf8.code_point_2 (b0 : U8) (b1 : U8) : Result utf8.CodePoint := do
  ok { bytes := (Array.make 4#usize [ b0, b1, 0#u8, 0#u8 ]), len := 2#u8 }

/- [utf8_parser::utf8::code_point_3]:
   Source: 'src/utf8.rs', lines 87:0-92:1 -/
def utf8.code_point_3
  (b0 : U8) (b1 : U8) (b2 : U8) : Result utf8.CodePoint := do
  ok { bytes := (Array.make 4#usize [ b0, b1, b2, 0#u8 ]), len := 3#u8 }

/- [utf8_parser::utf8::code_point_4]:
   Source: 'src/utf8.rs', lines 95:0-100:1 -/
def utf8.code_point_4
  (b0 : U8) (b1 : U8) (b2 : U8) (b3 : U8) : Result utf8.CodePoint := do
  ok { bytes := (Array.make 4#usize [ b0, b1, b2, b3 ]), len := 4#u8 }

/- [utf8_parser::utf8::code_point_byte0]:
   Source: 'src/utf8.rs', lines 103:0-105:1 -/
def utf8.code_point_byte0 (cp : utf8.CodePoint) : Result U8 := do
  Array.index_usize cp.bytes 0#usize

/- [utf8_parser::utf8::code_point_byte1]:
   Source: 'src/utf8.rs', lines 108:0-110:1 -/
def utf8.code_point_byte1 (cp : utf8.CodePoint) : Result U8 := do
  Array.index_usize cp.bytes 1#usize

/- [utf8_parser::utf8::code_point_byte2]:
   Source: 'src/utf8.rs', lines 113:0-115:1 -/
def utf8.code_point_byte2 (cp : utf8.CodePoint) : Result U8 := do
  Array.index_usize cp.bytes 2#usize

/- [utf8_parser::utf8::code_point_byte3]:
   Source: 'src/utf8.rs', lines 118:0-120:1 -/
def utf8.code_point_byte3 (cp : utf8.CodePoint) : Result U8 := do
  Array.index_usize cp.bytes 3#usize

/- [utf8_parser::utf8::code_point_eq]:
   Source: 'src/utf8.rs', lines 123:0-129:1 -/
def utf8.code_point_eq
  (a : utf8.CodePoint) (b : utf8.CodePoint) : Result Bool := do
  if a.len = b.len
  then
    let i ← Array.index_usize a.bytes 0#usize
    let i1 ← Array.index_usize b.bytes 0#usize
    if i = i1
    then
      let i2 ← Array.index_usize a.bytes 1#usize
      let i3 ← Array.index_usize b.bytes 1#usize
      if i2 = i3
      then
        let i4 ← Array.index_usize a.bytes 2#usize
        let i5 ← Array.index_usize b.bytes 2#usize
        if i4 = i5
        then
          let i6 ← Array.index_usize a.bytes 3#usize
          let i7 ← Array.index_usize b.bytes 3#usize
          ok (i6 = i7)
        else ok false
      else ok false
    else ok false
  else ok false

end utf8_parser
